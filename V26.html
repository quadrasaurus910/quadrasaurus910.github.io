<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Valentine's Day</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #fce4ec;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* --- LAYER 1: ORBITAL HEARTS (Background) --- */
        #heart-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1; 
            pointer-events: none;
        }

        .falling-heart {
            position: absolute;
            will-change: transform;
            -webkit-mask-size: contain;
            mask-size: contain;
            -webkit-mask-repeat: no-repeat;
            mask-repeat: no-repeat;
            -webkit-mask-position: center;
            mask-position: center;
        }

        /* --- LAYER 2: TEXT ANIMATION (Left Aligned) --- */
        #text-container {
            position: absolute;
            top: 40%; /* Adjust vertical placement */
            left: 10%; /* Closer to the left side */
            transform: translateY(-50%);
            z-index: 10;
            display: flex;
            flex-direction: column; /* Stacks words vertically */
            align-items: flex-start; /* Aligns starts of words */
        }

        .word-line {
            font-size: 7rem; /* Big text */
            font-weight: 800;
            margin: 15px 0px 15px 0px;
            color: #880e4f;
            line-height: 1.1;
            white-space: nowrap; /* Keeps word on one line */
            position: relative;
        }

        /* The individual letter style */
        .letter {
            display: inline-block;
            opacity: 0; /* Invisible start */
            transform: translateY(40px);
        }

        /* The "Pop, Float, Settle" Animation */
        @keyframes popUpFloat {
            0% {
                opacity: 0;
                transform: translateY(40px) scale(0.5);
            }
            60% {
                opacity: 1;
                transform: translateY(-15px) scale(1.1); /* The overshoot */
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1); /* Settle */
            }
        }

        /* --- LAYER 3: HANDWRITING (Overlaying "Day") --- */
        #handwriting-layer {
            position: absolute;
            z-index: 20;
            /* Positioning strategy: 
               We put it inside the container via absolute position
               so it sits right on top of the last word.
            */
            top: 85%;  /* Adjusts overlap with "Day" */
            left: -20px; /* Slight offset to cover the word */
            pointer-events: none;
        }

    </style>
</head>
<body>

    <div id="heart-layer"></div>

    <div id="text-container">
        <div id="line1" class="word-line">Happy</div>
        <div id="line2" class="word-line">Valentine's</div>
        <div id="line3" class="word-line">Day</div>

        <div id="handwriting-layer">
            
            </div>
    </div>

    <script>
        /* ============================================================
           â¤ï¸ CONFIGURATION
           ============================================================ */
        const config = {
            // Updated Colors
            colors: ['#e91e63', '#9c27b0', '#f44336', '#ff4081', '#ff5252', '#d500f9', '#c2185b'],
            totalImages: 9, 
            slant: 200, speedMin: 3, speedMax: 8,
            sizeMin: 20, sizeMax: 60,
            opacityMin: 0.3, opacityMax: 0.9,
            wobbleSpeed: 2, wobbleAmp: 30,
            spinSpeedMin: 0.5, spinSpeedMax: 3,
            spawnFast: 50, spawnSlow: 1200, clusterChance: 0.6
        };

        /* ============================================================
           ðŸŽ¬ MASTER DIRECTOR (TIMELINE)
           ============================================================ */
        document.addEventListener("DOMContentLoaded", () => {
            
            // 1. Start Hearts
            startHeartRain();

            // 2. Start Text Animation (Wait 1s)
            setTimeout(() => {
                animateText();
            }, 1000);

            // 3. Start Handwriting 
            // We calculate this based on when "Day" finishes.
            // Text animation takes roughly 2.5 seconds total with staggers.
            // So we start handwriting at 1s (initial delay) + 2.5s (anim) = 3.5s
            setTimeout(() => {
                if (window.playHandwriting) {
                    window.playHandwriting();
                }
            }, 3800); 
        });

        /* ============================================================
           ðŸ“ TEXT ENGINE (Pop & Float)
           ============================================================ */
        function animateText() {
            const lines = ['line1', 'line2', 'line3'];
            let globalDelay = 0; // Tracks time across words

            lines.forEach((lineId, lineIndex) => {
                const element = document.getElementById(lineId);
                const text = element.innerText;
                element.innerHTML = ''; // Clear text to replace with spans

                // Split into letters
                [...text].forEach((char, charIndex) => {
                    const span = document.createElement('span');
                    span.innerText = char;
                    span.className = 'letter';
                    
                    // Handle spaces (they need width)
                    if (char === ' ') span.style.width = '20px';

                    // ANIMATION LOGIC
                    // 1. Stagger letters quickly (0.05s apart)
                    // 2. Stagger words (add extra time per line)
                    const letterDelay = charIndex * 0.1; 
                    const totalDelay = globalDelay + letterDelay;

                    span.style.animation = `popUpFloat 1s cubic-bezier(0.25, 1, 0.5, 1) forwards`;
                    span.style.animationDelay = `${totalDelay}s`;

                    element.appendChild(span);
                });

                // Add delay before next word starts (Overlap effect)
                // We don't wait for the whole word to finish, just enough to look nice
                globalDelay += 0.4; 
            });
        }

        /* ============================================================
           â¤ï¸ HEART ENGINE
           ============================================================ */
        function startHeartRain() {
            spawnHeart();
        }

        function spawnHeart() {
            const container = document.getElementById('heart-layer');
            const el = document.createElement('div');
            el.className = 'falling-heart';

            const imgNum = Math.floor(Math.random() * config.totalImages) + 1;
            const color = config.colors[Math.floor(Math.random() * config.colors.length)];
            
            el.style.backgroundColor = color;
            el.style.webkitMaskImage = `url('heart${imgNum}.png')`;
            el.style.maskImage = `url('heart${imgNum}.png')`;

            const startX = Math.random() * window.innerWidth;
            const size = random(config.sizeMin, config.sizeMax);
            const duration = random(config.speedMin, config.speedMax);
            const opacity = random(config.opacityMin, config.opacityMax);
            
            const spinDir = Math.random() > 0.5 ? 1 : -1;
            const spinSpeed = random(config.spinSpeedMin, config.spinSpeedMax) * spinDir;
            const wobbleOffset = Math.random() * Math.PI * 2;

            el.style.width = `${size}px`;
            el.style.height = `${size}px`;
            el.style.opacity = opacity;
            el.style.left = `${startX}px`;
            // Spawn further up so they don't pop in
            el.style.top = `-${size + 100}px`; 

            container.appendChild(el);

            let startTime = null;
            
            function animate(time) {
                if (!startTime) startTime = time;
                const progress = (time - startTime) / (duration * 1000);

                if (progress > 1) {
                    el.remove();
                    return;
                }

                // --- FIX FOR DISAPPEARING HEARTS ---
                // Previously: window.innerHeight
                // Now: window.innerHeight + 300
                // This ensures they go WAY off screen before deleting
                const currentY = -100 + (progress * (window.innerHeight + 300));

                const slantX = progress * config.slant;
                const wiggle = Math.sin((progress * config.wobbleSpeed * 10) + wobbleOffset) * config.wobbleAmp;
                const currentX = slantX + wiggle;
                const rotation = progress * 360 * spinSpeed;

                el.style.transform = `translate(${currentX}px, ${currentY}px) rotate(${rotation}deg)`;
                requestAnimationFrame(animate);
            }
            requestAnimationFrame(animate);

            const isCluster = Math.random() < config.clusterChance;
            const delay = isCluster 
                ? random(config.spawnFast, config.spawnFast + 150)
                : random(config.spawnSlow, config.spawnSlow + 800);
            
            setTimeout(spawnHeart, delay);
        }

        function random(min, max) { return Math.random() * (max - min) + min; }

    </script>
</body>
</html>
