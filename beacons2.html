<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beacons HUD - Mobile</title>
<style>
/* ----------------- GLOBAL STYLES ----------------- */
:root {
  --bg-top: #0b1d33;
  --bg-bottom: #1a2639;
  --accent: #00e5ff; /* Cyan HUD accent */
  --glass: rgba(16, 20, 30, 0.85);
  --border: rgba(255, 255, 255, 0.2);
  --text-main: #ffffff;
  --text-dim: rgba(255, 255, 255, 0.6);
}

* { box-sizing: border-box; }

body {
  margin: 0; 
  height: 100vh;
  font-family: "Segoe UI", Trebuchet MS, sans-serif;
  color: var(--text-main);
  background: linear-gradient(to bottom, var(--bg-top), var(--bg-bottom));
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* ----------------- MOBILE HEADER ----------------- */
#mobile-header {
    display: none; /* Hidden on desktop */
    padding: 15px;
    background: var(--glass);
    border-bottom: 1px solid var(--border);
    justify-content: space-between;
    align-items: center;
    z-index: 20;
}
.menu-btn { 
    font-size: 24px; 
    cursor: pointer; 
    background: none; 
    border: 1px solid var(--accent); 
    color: var(--accent); 
    padding: 2px 10px; 
    border-radius: 4px;
}

/* ----------------- APP LAYOUT ----------------- */
#app {
  display: grid;
  grid-template-columns: 240px 1fr; /* Desktop default */
  height: 100%;
  position: relative;
}

/* ----------------- SIDEBAR MENU ----------------- */
#menu {
  background: var(--glass);
  border-right: 1px solid var(--border);
  padding: 20px;
  backdrop-filter: blur(10px);
  transition: transform 0.3s ease;
  z-index: 30;
}

.menu-title { 
    font-size: 12px; 
    letter-spacing: 2px; 
    margin-bottom: 20px; 
    color: var(--accent); 
    font-weight: bold; 
}

.menu-item {
  padding: 12px;
  margin-bottom: 8px;
  cursor: pointer;
  border-left: 3px solid transparent;
  transition: 0.2s;
  color: var(--text-dim);
}
.menu-item:hover, .menu-item.active {
  border-left: 3px solid var(--accent);
  background: rgba(0, 229, 255, 0.1);
  color: white;
}

/* ----------------- MAIN CONTENT ----------------- */
#main { 
  padding: 20px; 
  overflow-y: auto; 
  display: flex; 
  flex-direction: column; 
  gap: 15px;
}

/* WEATHER WIDGET (New) */
#weather-widget {
    background: rgba(0,0,0,0.3);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.temp-display { font-size: 24px; font-weight: bold; }
.loc-display { font-size: 12px; color: var(--text-dim); }

/* PANELS */
.hud-panel {
  background: var(--glass);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 15px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

.panel-title {
  color: var(--accent);
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 10px;
  border-bottom: 1px solid var(--border);
  padding-bottom: 5px;
}

/* INPUTS GRID (For Stats) */
.stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 10px;
}
.stat-box label { font-size: 10px; display: block; color: var(--text-dim); margin-bottom: 4px; }
.stat-box input { 
    width: 100%; 
    background: rgba(0,0,0,0.5); 
    border: 1px solid var(--border); 
    color: white; 
    padding: 8px; 
    border-radius: 4px; 
}

/* OPTION BUTTONS */
.opt-row { display: flex; gap: 5px; margin-bottom: 8px; }
.opt-btn {
    flex: 1;
    background: transparent;
    border: 1px solid var(--border);
    color: var(--text-dim);
    padding: 8px;
    cursor: pointer;
    font-size: 12px;
    border-radius: 4px;
}
.opt-btn.active { background: var(--accent); color: #000; font-weight: bold; border-color: var(--accent); }

textarea {
    width: 100%;
    background: rgba(0,0,0,0.5);
    border: 1px solid var(--border);
    color: white;
    padding: 10px;
    border-radius: 4px;
    resize: none;
    min-height: 80px;
}

button.save-btn {
    width: 100%;
    background: var(--accent);
    color: #0b1d33;
    font-weight: bold;
    border: none;
    padding: 12px;
    border-radius: 4px;
    margin-top: 10px;
    cursor: pointer;
}

/* ----------------- MOBILE RESPONSIVE ----------------- */
@media (max-width: 768px) {
    #mobile-header { display: flex; }
    
    #app {
        grid-template-columns: 1fr; /* Stack layout */
        height: calc(100vh - 60px); /* Adjust for header */
    }

    #menu {
        position: fixed;
        top: 60px; /* Below header */
        left: 0; bottom: 0;
        width: 250px;
        transform: translateX(-100%); /* Hide off-screen */
        box-shadow: 2px 0 10px rgba(0,0,0,0.5);
    }
    
    #menu.open { transform: translateX(0); }
}
</style>
</head>
<body>

<div id="mobile-header">
    <div style="font-weight:bold; letter-spacing:1px;">BEACONS HUD</div>
    <button class="menu-btn" onclick="toggleMenu()">☰</button>
</div>

<div id="app">
  <div id="menu">
    <div class="menu-title">SYSTEM</div>
    <div class="menu-item active">DASHBOARD</div>
    <div class="menu-item">LOG HISTORY</div>
    <div class="menu-item">SETTINGS</div>
    <div style="margin-top:auto; font-size:10px; color:rgba(255,255,255,0.3); padding-top:20px;">
        STORAGE USED: <span id="storage-meter">0</span>%
    </div>
  </div>

  <div id="main">
    
    <div id="weather-widget">
        <div>
            <div class="temp-display" id="temp-val">--°</div>
            <div class="loc-display" id="loc-val">Locating...</div>
        </div>
        <div style="text-align:right;">
            <div style="font-size:12px; color:var(--text-dim);" id="date-display">--</div>
        </div>
    </div>

    <div class="hud-panel">
        <div class="panel-title">Current Status</div>
        <div id="options-container">
            </div>
    </div>

    <div class="hud-panel">
        <div class="panel-title">Daily Metrics</div>
        <div class="stats-grid">
            <div class="stat-box">
                <label>MONEY ($)</label>
                <input type="number" id="in-money" placeholder="0">
            </div>
            <div class="stat-box">
                <label>STEPS</label>
                <input type="number" id="in-steps" placeholder="0">
            </div>
            <div class="stat-box">
                <label>HOURS</label>
                <input type="number" id="in-hours" placeholder="0">
            </div>
        </div>
    </div>

    <div class="hud-panel">
        <div class="panel-title">Mission Log</div>
        <textarea id="in-notes" placeholder="Log details..."></textarea>
    </div>

    <button class="save-btn" onclick="saveData()">SAVE ENTRY</button>

  </div>
</div>

<script>
// 1. STATE & OPTIONS
const Options = {
  Mood: ['Focus', 'Chill', 'Burnout'],
  Work: ['Active', 'Idle', 'Done'],
  Energy: ['High', 'Med', 'Low']
};

let STATE = {
    selections: { Mood: 'Focus', Work: 'Active', Energy: 'High' },
    stats: { money: 0, steps: 0, hours: 0 },
    notes: ''
};

// 2. INIT
function init() {
    // Set Date
    document.getElementById('date-display').innerText = new Date().toDateString();
    
    // Build Buttons
    const container = document.getElementById('options-container');
    for (let key in Options) {
        let row = document.createElement('div');
        row.className = 'opt-row';
        
        let label = document.createElement('div');
        label.style.width = '60px';
        label.style.fontSize = '12px';
        label.style.padding = '8px 0';
        label.innerText = key;
        row.appendChild(label);

        Options[key].forEach(opt => {
            let btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.innerText = opt;
            btn.onclick = () => selectOption(key, opt, btn);
            if (STATE.selections[key] === opt) btn.classList.add('active');
            row.appendChild(btn);
        });
        container.appendChild(row);
    }

    // Load Data
    loadData();
    
    // Get Weather
    getWeather();
    
    // Check Storage size
    checkStorage();
}

// 3. INTERACTION
function toggleMenu() {
    document.getElementById('menu').classList.toggle('open');
}

function selectOption(category, value, btnElement) {
    STATE.selections[category] = value;
    // Visually update buttons in that row
    let siblings = btnElement.parentElement.querySelectorAll('.opt-btn');
    siblings.forEach(s => s.classList.remove('active'));
    btnElement.classList.add('active');
}

// 4. DATA HANDLING (LocalStorage)
function saveData() {
    // Grab inputs
    STATE.stats.money = document.getElementById('in-money').value;
    STATE.stats.steps = document.getElementById('in-steps').value;
    STATE.stats.hours = document.getElementById('in-hours').value;
    STATE.notes = document.getElementById('in-notes').value;

    const dateKey = new Date().toISOString().slice(0,10);
    const logs = JSON.parse(localStorage.getItem('beaconLogs') || '{}');
    logs[dateKey] = STATE;
    
    localStorage.setItem('beaconLogs', JSON.stringify(logs));
    alert('Log Saved');
    checkStorage();
}

function loadData() {
    const dateKey = new Date().toISOString().slice(0,10);
    const logs = JSON.parse(localStorage.getItem('beaconLogs') || '{}');
    
    if (logs[dateKey]) {
        STATE = logs[dateKey];
        // Restore Inputs
        document.getElementById('in-money').value = STATE.stats.money;
        document.getElementById('in-steps').value = STATE.stats.steps;
        document.getElementById('in-hours').value = STATE.stats.hours;
        document.getElementById('in-notes').value = STATE.notes;
        
        // Restore Buttons (Simple re-render logic for demo)
        document.getElementById('options-container').innerHTML = '';
        const container = document.getElementById('options-container');
        for (let key in Options) {
            let row = document.createElement('div');
            row.className = 'opt-row';
            let label = document.createElement('div');
            label.style.width = '60px'; label.style.fontSize='12px'; label.style.padding='8px 0'; label.innerText = key;
            row.appendChild(label);

            Options[key].forEach(opt => {
                let btn = document.createElement('button');
                btn.className = 'opt-btn';
                btn.innerText = opt;
                btn.onclick = () => selectOption(key, opt, btn);
                if (STATE.selections[key] === opt) btn.classList.add('active');
                row.appendChild(btn);
            });
            container.appendChild(row);
        }
    }
}

function checkStorage() {
    // Simple calculation of used space vs approx 5MB limit
    const used = JSON.stringify(localStorage).length;
    const max = 5 * 1024 * 1024; // 5MB
    const pct = ((used / max) * 100).toFixed(2);
    document.getElementById('storage-meter').innerText = pct;
}

// 5. WEATHER API (Open-Meteo)
function getWeather() {
    if (!navigator.geolocation) return;

    navigator.geolocation.getCurrentPosition(position => {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        
        // Fetch from Open-Meteo (Free, No Key)
        fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&temperature_unit=fahrenheit`)
            .then(res => res.json())
            .then(data => {
                const temp = Math.round(data.current_weather.temperature);
                document.getElementById('temp-val').innerText = `${temp}°F`;
                document.getElementById('loc-val').innerText = `Lat: ${lat.toFixed(2)}`; // Display coords or reverse geocode if needed
            });
    }, error => {
        document.getElementById('loc-val').innerText = "Loc Access Denied";
    });
}

init();
</script>
</body>
</html>
