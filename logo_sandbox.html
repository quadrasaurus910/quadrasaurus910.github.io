<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Logo Animation Sandbox</title>
    <style>
        body {
            background-color: #1a1a1a;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            color: white;
            font-family: sans-serif;
        }

        /* The canvas takes the place of our old container */
        #logoCanvas {
            width: 500px;
            height: 500px;
            /* A subtle glow behind the whole canvas to keep the glassmorphism vibe */
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.15));
        }
        
        #loadingMsg {
            position: absolute;
        }
    </style>
</head>
<body>

    <div id="loadingMsg">Loading high-res pieces...</div>
    
    <canvas id="logoCanvas" width="1000" height="1000" style="display: none;"></canvas>

    <script>
        const canvas = document.getElementById('logoCanvas');
        const ctx = canvas.getContext('2d');
        const loadingMsg = document.getElementById('loadingMsg');

        // --- THEME COLORS ---
        const themeColors = {
            outer: '#FFFFFF',
            ul: '#FF3366', 
            ur: '#33CCFF', 
            lr: '#FFCC00', 
            ll: '#00FF99'  
        };

        function getRandomRgbColorArray() {
            const randomRgbValues = Array.from({ length: 3 }, () => Math.floor(Math.random() * 256));
            return `rgb(${randomRgbValues.join(', ')})`;
        }

        // --- IMAGE LOADING & TINTING ENGINE ---
        // This function colors your PNGs using canvas compositing instead of CSS masks
        function tintImage(img, color) {
            const tCanvas = document.createElement('canvas');
            tCanvas.width = canvas.width;
            tCanvas.height = canvas.height;
            const tCtx = tCanvas.getContext('2d');
            
            // Draw original image (scaled to canvas)
            tCtx.drawImage(img, 0, 0, canvas.width, canvas.height);
            // This magic blend mode only paints where the image already has pixels!
            tCtx.globalCompositeOperation = 'source-in';
            tCtx.fillStyle = color;
            tCtx.fillRect(0, 0, canvas.width, canvas.height);
            
            return tCanvas; // Returns a pre-colored canvas we can use like an image
        }

        const pieces = {};

        // Helper to load an image
        function loadImage(name, src, color) {
            return new Promise((resolve) => {
                const img = new Image();
                img.src = src;
                img.onload = () => {
                    pieces[name] = {
                        image: tintImage(img, color), // Store the pre-colored version
                        // Independent random state tracking for each piece
                        opacity: Math.random(),
                        targetOpacity: Math.random(),
                        speed: (Math.random() * 0.01) + 0.002 // Random fade speed
                    };
                    resolve();
                };
            });
        }

        // --- THE ANIMATION KEEPER ---
        function startAnimation() {
            // Hide loading text, show canvas
            loadingMsg.style.display = 'none';
            canvas.style.display = 'block';

            function loop() {
                // 1. Clear the board for the next frame
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // 2. Draw the outer circle steady at 100% opacity
                ctx.globalAlpha = 1.0;
                ctx.drawImage(pieces.outer.image, 0, 0);

                // 3. Update and draw the inner pieces independently
                const color1 = getRandomRgbColor();
                const color2 = getRandomRgbColor();
                const color3 = getRandomRgbColor();
                const color4 = getRandomRgbColor();
                const color5 = getRandomRgbColor();
                const innerParts = ['ul', 'ur', 'lr', 'll'];
                
                innerParts.forEach(partKey => {
                    let part = pieces[partKey];

                    // Move current opacity toward the target opacity
                    if (part.opacity < part.targetOpacity) {
                        part.opacity += part.speed;
                        part.color = getRandomRgbColor();
                        if (part.opacity >= part.targetOpacity) part.opacity = part.targetOpacity; // Cap it
                    } else if (part.opacity > part.targetOpacity) {
                        part.opacity -= part.speed;
                        if (part.opacity <= part.targetOpacity) part.opacity = part.targetOpacity; // Cap it
                    }

                    // If it hit the target, generate a new random target and random speed!
                    if (part.opacity === part.targetOpacity) {
                        part.targetOpacity = (Math.random() * 0.9) + 0.1; // Don't let it go completely invisible (min 0.1)
                        part.speed = (Math.random() * 0.015) + 0.005; 
                    }

                    // Apply the independent opacity and draw the piece
                    ctx.globalAlpha = part.opacity;
                    ctx.drawImage(part.image, 0, 0);
                });

                // 4. Tell the browser to run this loop again on the very next screen refresh
                requestAnimationFrame(loop);
            }

            // Kick off the loop
            loop();
        }

        // --- INITIALIZATION ---
        // Load all images, then start the animation
        Promise.all([
            loadImage('outer', 'logo-outer.png', themeColors.outer),
            loadImage('ul', 'logo-ul.png', themeColors.ul),
            loadImage('ur', 'logo-ur.png', themeColors.ur),
            loadImage('lr', 'logo-lr.png', themeColors.lr),
            loadImage('ll', 'logo-ll.png', themeColors.ll)
        ]).then(() => {
            startAnimation();
        });

    </script>
</body>
</html>
